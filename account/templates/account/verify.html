{% load static %}
<!doctype html>
<html class="no-js" lang="Fa_IR" dir="rtl">
<head>
    <meta charset="utf-8">
    <title>تایید کد</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-4">
            <h3 class="mb-4 text-center">تایید کد پیامکی</h3>
            {% if messages %}
            <div class="mb-3">
                {% for message in messages %}
                    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} mb-2" role="alert">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
            {% if debug_code %}
            <div class="alert alert-info small">
                حالت تست فعال است. کد شما: <strong>{{ debug_code }}</strong>
            </div>
            {% endif %}
            {% if remaining is not None %}
            <div class="alert alert-warning py-2 small" id="expiryBox">
                کد تا <span id="countdown">{{ remaining }}</span> ثانیه دیگر معتبر است.
            </div>
            {% endif %}
            <form method="post" action="">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label">شماره موبایل</label>
                    <input type="tel" name="phone" class="form-control" value="{{ phone }}" placeholder="09000000000">
                </div>
                <div class="mb-3">
                    <label class="form-label">کد تایید</label>
                    <input type="text" name="code" class="form-control" maxlength="6" placeholder="مثلاً 123456">
                </div>
                <button type="submit" class="btn btn-success w-100">ورود</button>
            </form>
            <div class="mt-3 text-center">
                <a href="{% url 'login' %}">ویرایش شماره</a>
            </div>
        </div>
    </div>
</div>
<script>
    (function(){
        var countdownEl = document.getElementById('countdown');
        if (!countdownEl) return;
        var secs = parseInt(countdownEl.textContent || '0');
        var box = document.getElementById('expiryBox');
        var timer = setInterval(function(){
            secs -= 1;
            if (secs <= 0){
                clearInterval(timer);
                countdownEl.textContent = '0';
                if (box) { box.className = 'alert alert-danger py-2 small'; box.textContent = 'کد منقضی شد. لطفاً دوباره درخواست دهید.'; }
                return;
            }
            countdownEl.textContent = String(secs);
        }, 1000);
    })();
</script>
</body>
</html>
