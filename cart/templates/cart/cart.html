{% extends "_base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<main class="main cart rtl text-right">
  <div class="container py-5">
    <h3 class="mb-5 text-center">ğŸ› Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§</h3>

    {% if cart_items %}
    <form method="post" class="shadow p-4 bg-white rounded-4">
      {% csrf_token %}

      <div class="table-responsive">
        <table class="table table-striped text-center align-middle border">
          <thead class="table-dark">
            <tr>
              <th>Ù…Ø­ØµÙˆÙ„</th>
              <th>Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
              <th style="width:120px;">ØªØ¹Ø¯Ø§Ø¯</th>
              <th>Ø¬Ù…Ø¹</th>
              <th>Ø­Ø°Ù</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart_items %}
            <tr>
              <td class="text-start">
                <div class="d-flex align-items-center gap-3">
                  {% if item.product.image %}
                  <img src="{{ item.product.image.url }}" alt="{{ item.product.title }}"
                       class="rounded" width="70" height="70">
                  {% endif %}
                  <div>
                    <strong>{{ item.product.title }}</strong><br>
                    <small class="text-muted">
                      Ø±Ù†Ú¯: {{ item.color.title }} | Ø³Ø§ÛŒØ²: {{ item.size.title }}
                    </small>
                  </div>
                </div>
              </td>

              <td>{{ item.price|intcomma }} ØªÙˆÙ…Ø§Ù†</td>

              <td>
                <input type="number" name="count_{{ item.id }}" value="{{ item.count }}" min="1"
                       class="form-control text-center mx-auto" style="width:90px;">
              </td>

              <td><strong>{{ item.subtotal|intcomma }}</strong> ØªÙˆÙ…Ø§Ù†</td>

              <td>
                <button type="submit" name="delete_{{ item.id }}" class="btn btn-outline-danger btn-sm">
                  âŒ Ø­Ø°Ù
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="text-center mt-4">
        <h5 class="fw-bold">ğŸ’° Ø¬Ù…Ø¹ Ú©Ù„: {{ total_price|intcomma }} ØªÙˆÙ…Ø§Ù†</h5>
      </div>

      <div class="d-flex justify-content-center gap-3 mt-4">
        <button type="submit" class="btn btn-dark px-4">Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª</button>

        {% if user.is_authenticated %}
        <a href="{% url 'checkout' %}" class="btn btn-success px-5">Ù†Ù‡Ø§ÛŒÛŒ Ú©Ø±Ø¯Ù† Ø³ÙØ§Ø±Ø´</a>
        {% else %}
        <a href="{% url 'login' %}?next={% url 'checkout' %}" class="btn btn-warning px-5">
          ÙˆØ±ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ú©Ø±Ø¯Ù† Ø³ÙØ§Ø±Ø´
        </a>
        {% endif %}
      </div>
    </form>

    {% else %}
    <div class="text-center mt-5">
      <p class="fs-5">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª ğŸ›’</p>
      <a href="{% url 'product_list' %}" class="btn btn-outline-dark mt-3">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</a>
    </div>
    {% endif %}
  </div>
</main>
{% endblock %}

